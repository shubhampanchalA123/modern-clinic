{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/Desktop/modernfronted/HairGrowth-Clinic/app/payment-method/online/page.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { motion } from \"framer-motion\";\r\nimport { useSearchParams, useRouter } from \"next/navigation\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { verifyPayment } from \"@/redux/slices/registerSlice\";\r\nimport { createAppointmentOrder, verifyAppointmentPayment } from \"@/redux/slices/appointmentSlice\";\r\n\r\nexport default function OnlinePaymentPage() {\r\n  const params = useSearchParams();\r\n  const router = useRouter();\r\n  const dispatch = useDispatch();\r\n\r\n  const { createAppointmentOrderSuccess, orderDetails } = useSelector((state) => state.appointment);\r\n\r\n  const [razorpayLoaded, setRazorpayLoaded] = useState(false);\r\n  const [isAppointment, setIsAppointment] = useState(false);\r\n\r\n  const orderId = params.get(\"orderId\") || (orderDetails ? orderDetails.orderId : null);\r\n  const amount = params.get(\"amount\") || (orderDetails ? orderDetails.amount : null);\r\n  const currency = params.get(\"currency\") || (orderDetails ? orderDetails.currency : null);\r\n  const key = params.get(\"key\") || (orderDetails ? orderDetails.key : null);\r\n  const consultantId = params.get(\"consultantId\");\r\n\r\n  // Get appointment data with expiration check (24 hours)\r\n  const getAppointmentData = () => {\r\n    const data = localStorage.getItem(\"appointmentData\");\r\n    if (data) {\r\n      const parsed = JSON.parse(data);\r\n      const now = Date.now();\r\n      const hoursDiff = (now - parsed.timestamp) / (1000 * 60 * 60);\r\n      if (hoursDiff < 24) {\r\n        return parsed;\r\n      } else {\r\n        localStorage.removeItem(\"appointmentData\");\r\n        return null;\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const appointmentData = getAppointmentData();\r\n  const appointmentId = appointmentData?.appointmentId;\r\n  const appointmentAmount = appointmentData?.amount;\r\n\r\n  // Check if appointment and create order\r\n  useEffect(() => {\r\n    if (appointmentId && appointmentAmount && !orderId) {\r\n      setIsAppointment(true);\r\n      dispatch(createAppointmentOrder({\r\n        appointmentId,\r\n        amount: parseInt(appointmentAmount)\r\n      }));\r\n    }\r\n  }, [appointmentId, appointmentAmount, orderId, dispatch]);\r\n\r\n  // Load Razorpay script\r\n  useEffect(() => {\r\n    const script = document.createElement(\"script\");\r\n    script.src = \"https://checkout.razorpay.com/v1/checkout.js\";\r\n    script.onload = () => setRazorpayLoaded(true);\r\n    document.body.appendChild(script);\r\n  }, []);\r\n\r\n  const handlePayment = () => {\r\n    if (!razorpayLoaded || !window.Razorpay) {\r\n      alert(\"Razorpay not loaded\");\r\n      return;\r\n    }\r\n\r\n    const options = {\r\n      key: key,\r\n      amount: amount,\r\n      currency: currency,\r\n      order_id: orderId,\r\n      name: \"Hair Growth Clinic\",\r\n      description: \"Consultation Payment\",\r\n      handler: function (response) {\r\n        // Payment success\r\n        if (isAppointment) {\r\n          dispatch(verifyAppointmentPayment({\r\n            appointmentId,\r\n            razorpay_payment_id: response.razorpay_payment_id,\r\n            razorpay_order_id: response.razorpay_order_id,\r\n            razorpay_signature: response.razorpay_signature\r\n          })).then((result) => {\r\n            if (result.meta.requestStatus === \"fulfilled\") {\r\n              localStorage.removeItem(\"appointmentData\");\r\n              router.push(\"/payment-method/success\");\r\n            } else {\r\n              router.push(\"/payment-method/failed\");\r\n            }\r\n          });\r\n        } else {\r\n          dispatch(verifyPayment({\r\n            consultantId,\r\n            razorpay_payment_id: response.razorpay_payment_id,\r\n            razorpay_order_id: response.razorpay_order_id,\r\n            razorpay_signature: response.razorpay_signature\r\n          })).then((result) => {\r\n            if (result.meta.requestStatus === \"fulfilled\") {\r\n              router.push(\"/payment-method/success\");\r\n            } else {\r\n              router.push(\"/payment-method/failed\");\r\n            }\r\n          });\r\n        }\r\n      },\r\n      prefill: {\r\n        name: \"User Name\", // Can be from user data\r\n        email: \"user@example.com\",\r\n        contact: \"9999999999\"\r\n      },\r\n      theme: {\r\n        color: \"#007bff\"\r\n      }\r\n    };\r\n\r\n    const rzp = new window.Razorpay(options);\r\n    rzp.open();\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto px-6 py-20\">\r\n      <motion.div initial={{ opacity: 0, y: 12 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.4 }}>\r\n        <h1 className=\"text-3xl font-bold text-foreground\"><span className=\"text-primary\">Online</span> Payment</h1>\r\n        <p className=\"text-muted-foreground mt-2\">\r\n          Complete payment for {isAppointment ? \"Appointment\" : \"Consultation\"} using UPI, Credit/Debit Card or Net Banking.\r\n        </p>\r\n      </motion.div>\r\n\r\n      <motion.div\r\n        className=\"mt-10 p-6 rounded-2xl bg-card/70 backdrop-blur-xl border border-border shadow-sm\"\r\n        initial={{ opacity: 0, y: 16 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.5 }}\r\n      >\r\n        <div className=\"mb-4\">\r\n          <p className=\"text-sm text-muted-foreground\">Order ID: {orderId}</p>\r\n          <p className=\"text-sm text-muted-foreground\">Amount: â‚¹{amount / 100}</p>\r\n        </div>\r\n        <button\r\n          onClick={handlePayment}\r\n          disabled={!razorpayLoaded}\r\n          className=\"mt-6 bg-primary text-primary-foreground px-5 py-3 rounded-xl hover:bg-primary/80 transition disabled:opacity-50\"\r\n        >\r\n          {razorpayLoaded ? \"Proceed to Pay\" : \"Loading...\"}\r\n        </button>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}